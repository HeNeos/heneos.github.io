---
layout: post
title: Project Euler 625
subtitle: Gcd sum
gh-repo: HeNeos/heneos.github.io
gh-badge: [star, follow]
comments: true
tags: [Project Euler]
---

## Statement

\begin{aligned}
    G(N) = \sum_{j=1}^{N} \sum_{i=1}^{j} \gcd(i, j)
\end{aligned}

Find $G(10^{11})$. Give your answer modulo 998244353.

## Solution

\begin{aligned}
    g(n) &= \sum_{i=1}^{n} \gcd(i, n)\cr
    &= \sum_{k\vert n} k \phi\Big( \frac{n}{k} \Big)\cr
    &= (n * \phi)(n)
\end{aligned}

\begin{aligned}
    G(N) &= \sum_{i=1}^{N} g(i)\cr
    &= \sum_{i=1}^{N} \sum_{k \vert i} \phi(k) \frac{i}{k}\cr
    &= \sum_{k=1}^{N} \sum_{p=1}^{\frac{N}{k}} \phi(k) p\cr
    &= \sum_{k=1}^{N} \sum_{p=1}^{\frac{N}{k}} \phi(k) p\cr
    &= \sum_{k=1}^{N} \phi(k) \frac{\frac{N}{k}(\frac{N}{k} + 1)}{2}\cr
\end{aligned}

\begin{aligned}
    S(n) &= \sum_{i=1}^{n} \phi(i) \cr
    &= \sum_{b=1}^{n} \sum_{a=1}^{b} \big\vert \gcd(a, b) = 1 \big\vert \cr
    &= \frac{n(n+1)}{2} - \sum_{m=2}^{n} \sum_{y=1}^{\lfloor n/m \rfloor} \sum_{x=1}^{\lfloor b/m \rfloor} \big\vert \gcd(x, y) = 1 \big\vert \cr
    &= \frac{n(n+1)}{2} - \sum_{m=2}^{n} S(\lfloor n/m \rfloor) \cr
    &= \frac{n(n+1)}{2} - \sum_{m=2}^{\sqrt{n}} S(\lfloor n/m \rfloor) - \sum_{m=1}^{\lfloor \frac{n}{\lfloor \sqrt{n} \rfloor} \rfloor - 1} \Big(\Big\lfloor\frac{n}{m} \Big\rfloor - \Big\lfloor\frac{n}{m+1} \Big\rfloor \Big) S(m)\cr
    S(n) &= \Phi(n)
\end{aligned}

Similar to the explained in GCDEX, the list of possible values of $\lfloor N/k \rfloor$ has a size of $2\sqrt{N}$. I will use the hyperbola method to calculate it:

\begin{aligned}
    G(N) &= \sum_{k=1}^{N} \phi(k) \frac{\frac{N}{k}(\frac{N}{k} + 1)}{2}\cr
    &= \sum_{k=1}^{N} \phi(k) \sum_{ab=k} a \phi(b) \cr
    &= \sum_{a=1}^{\sqrt{N}} \sum_{b=1}^{N/a} a\phi(b) + \sum_{b=1}^{\sqrt{N}} \sum_{a=1}^{N/b} a\phi(b) - \sum_{a=1}^{\sqrt{N}} \sum_{b=1}^{\sqrt{N}} a\phi(b)\cr
    &= \sum_{a=1}^{\sqrt{N}} a \Phi(\lfloor N/a \rfloor) + \sum_{b=1}^{\lfloor \sqrt{N} \rfloor} \phi(b) \frac{\lfloor N/b\rfloor \times (\lfloor N/b\rfloor + 1)}{2} - \frac{\lfloor \sqrt{N}\rfloor (\lfloor \sqrt{N} \rfloor + 1)}{2}\Phi(\lfloor \sqrt{N} \rfloor)\cr
\end{aligned}

To optimize the complexity, suppose that we will do a sieve until $N/k$, so the overall complexity will be:

\begin{aligned}
    O(G(N)) &= O(\sum_{a=1}^{k} O(\Phi(\lfloor N/a\rfloor))) + O(\sqrt{N}) + O(N/k \log(N/k))\cr
    &= O(\sum_{a=1}^{k} \sqrt{\lfloor N/a\rfloor}) + O(\sqrt{N}) + O(N/k \log(N/k))\cr
    &= O(\sqrt{N}\sqrt{k}) + O(\sqrt{N}) + O(N/k \log(N/k))\cr
    &\text{Optimal value is when:}\cr
    & \sqrt{N}\sqrt{k} = \sqrt{N} + N/k \log(N/k)\cr
    & k \approx \frac{N^{1/3}}{3^{2/3}}\cr
    O(G(N)) &= O(N^{2/3} + \sqrt{N} + N^{2/3}\log(N^{2/3}))\cr
    &= O(N^{2/3}\log(N^{2/3}))
\end{aligned}

## Code

